<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Query Rewriting - RDS Performance Insights & Query Optimization</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css><link rel=stylesheet href=/css/theme-blue.css><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:work sans,helvetica,tahoma,geneva,arial,sans-serif;font-weight:300;line-height:1.6;font-size:18px;color:var(--MAIN-TEXT-color,#323232)}#sidebar{position:fixed;top:0;left:0;width:300px;height:100vh;background:var(--MENU-SECTIONS-BG-color,#252c31);color:#ccc;overflow-y:auto;z-index:1000}#sidebar #header{padding:2rem 1rem;text-align:center;background:var(--MENU-HEADER-BG-color,#1C90F3);border-bottom:1px solid var(--MENU-HEADER-BORDER-color,#33a1ff)}#sidebar #header .baseurl{color:var(--MENU-SEARCH-BOX-color,#33a1ff);font-size:1.5rem;font-weight:700}#sidebar .searchbox{padding:10px;background:var(--MENU-SEARCH-BG-color,#167ad0);border-bottom:1px solid var(--MENU-SEARCH-BOX-color,#33a1ff)}#sidebar .searchbox input{width:100%;padding:10px;border:1px solid var(--MENU-SEARCH-BOX-color,#33a1ff);background:rgba(255,255,255,.1);color:var(--MENU-SEARCH-BOX-ICONS-color,#a1d2fd);border-radius:4px}#sidebar-toggle-span{display:none}#body{margin-left:300px}#body .padding{padding:3rem 6rem}#sidebar ul{list-style:none;padding:0;margin:0}#sidebar ul li a{display:block;padding:10px 20px;color:var(--MENU-SECTIONS-LINK-color,#ccc);text-decoration:none;border-left:4px solid transparent}#sidebar ul li a:hover{background:var(--MENU-SECTIONS-ACTIVE-BG-color,#20272b);border-left-color:var(--MAIN-LINK-color,#1C90F3);color:var(--MENU-SECTIONS-LINK-HOVER-color,#e6e6e6)}#sidebar ul li.active>a{background:var(--MENU-SECTION-ACTIVE-CATEGORY-BG-color,#fff);border-left-color:var(--MAIN-LINK-color,#1C90F3);color:var(--MENU-SECTION-ACTIVE-CATEGORY-color,#777)}#sidebar ul ul{padding-left:20px}#sidebar ul ul li a{padding:8px 20px;font-size:.9em}.language-switcher{position:relative;padding:20px}.language-switcher a{color:var(--MAIN-LINK-color,#1C90F3);text-decoration:none;margin-left:10px}.language-switcher a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0)}h1,h2,h3,h4,h5,h6{color:var(--MAIN-TITLES-TEXT-color,#5e5e5e);font-weight:400}h1{font-size:3rem}h2{font-size:2.5rem}h3{font-size:2rem}a{color:var(--MAIN-LINK-color,#1C90F3)}a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0)}pre{background:#f8f8f8;padding:1rem;border-radius:4px;overflow-x:auto}code{background:#f8f8f8;padding:.2rem .4rem;border-radius:3px;font-size:.9em}.breadcrumbs{margin-bottom:2rem;color:#999}.breadcrumbs a{color:var(--MAIN-LINK-color,#1C90F3);text-decoration:none}.breadcrumbs a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0);text-decoration:underline}@media(max-width:768px){#sidebar{transform:translateX(-300px);transition:transform .3s}#sidebar.open{transform:translateX(0)}#body{margin-left:0}#body .padding{padding:1rem 2rem}#sidebar-toggle-span{display:block;position:fixed;top:10px;left:10px;z-index:1001}#sidebar-toggle{background:var(--MAIN-LINK-color,#1C90F3);color:#fff;padding:10px;border:none;border-radius:4px}}</style></head><body><nav id=sidebar><div id=header><a id=logo href=/><div style=text-align:center;padding:20px><h2 style=color:var(--MENU-SEARCH-BOX-color,#33a1ff);font-size:2rem;font-weight:700;margin:0>LEARN</h2><p style="color:var(--MENU-SEARCH-BOX-ICONS-color,#a1d2fd);font-size:.9rem;margin:5px 0 0">RDS Performance Insights</p></div></a></div><div class=searchbox><input type=search placeholder=Search... id=search-input></div><ul class=topics><li><a href=http://localhost:1313/><i class="fas fa-home"></i> Home</a></li><li><a href=/introduction/><i class="fas fa-book"></i> 1. Introduction</a></li><li><a href=/preparation/><i class="fas fa-book"></i> 2. Preparation</a></li><li><a href=/performance-baseline/><i class="fas fa-book"></i> 3. Performance Baseline Establishment</a></li><li><a href=/performance-insights/><i class="fas fa-book"></i> Performance Insights</a></li><li><a href=/monitoring-dashboard/><i class="fas fa-book"></i> 4. Monitoring Dashboard</a></li><li><a href=/alerting-system/><i class="fas fa-book"></i> 5. Alerting System</a></li><li class=active><a href=/query-optimization/><i class="fas fa-book"></i> 6. Query Optimization Techniques</a><ul><li><a href=/query-optimization/overview/>Overview</a></li><li><a href=/query-optimization/index-strategies/>Index Strategies</a></li><li class=active><a href=/query-optimization/query-rewriting/>Query Rewriting</a></li><li><a href=/query-optimization/execution-plans/>Execution Plans</a></li></ul></li><li><a href=/automated-tuning/><i class="fas fa-book"></i> 7. Automated Tuning Recommendations</a></li><li><a href=/capacity-planning/><i class="fas fa-book"></i> 8. Capacity Planning</a></li><li><a href=/monitoring/><i class="fas fa-book"></i> 9. Monitoring & Alerting</a></li><li><a href=/best-practices/><i class="fas fa-book"></i> 10. Best Practices & Resource Cleanup</a></li></ul><div class=language-switcher><a href=/vi><i class="fas fa-language"></i> Tiếng Việt</a></div></nav><span id=sidebar-toggle-span><a href=# id=sidebar-toggle><i class="fas fa-bars"></i></a></span><section id=body><div id=overlay></div><div class=padding><div id=body-inner><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>
<span>> </span><a href=/>RDS Performance Insights & Query Optimization</a>
<span>> </span><a href=/query-optimization/>6. Query Optimization Techniques</a>
<span>> </span>Query Rewriting</div><h1>Query Rewriting</h1><h1 id=query-rewriting---master-query-optimization-patterns>Query Rewriting - Master Query Optimization Patterns</h1><p>Rewriting or adjusting the structure of SQL queries can greatly impact how the database executes them. The goal is to help the database&rsquo;s Query Optimizer choose a more efficient execution plan.</p><h2 id=basic-principles>Basic Principles</h2><h3 id=avoid-select->Avoid SELECT *</h3><p>Only select the columns you actually need. This reduces the amount of data read from disk and transmitted over the network.</p><h3 id=use-join-instead-of-subqueries-for-some-cases>Use JOIN instead of Subqueries (for some cases)</h3><p>Sometimes, subqueries can be rewritten as JOINs to improve performance, especially IN subqueries.</p><p><strong>Example:</strong></p><p>Less optimal:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> orders 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> customer_id <span style=color:#66d9ef>IN</span> (<span style=color:#66d9ef>SELECT</span> id <span style=color:#66d9ef>FROM</span> customers <span style=color:#66d9ef>WHERE</span> region <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Asia&#39;</span>);
</span></span></code></pre></div><p>More optimal:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> o.<span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> orders o 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> customers <span style=color:#66d9ef>c</span> <span style=color:#66d9ef>ON</span> o.customer_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>c</span>.region <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Asia&#39;</span>;
</span></span></code></pre></div><h3 id=avoid-operations-or-functions-on-indexed-columns-in-where>Avoid operations or functions on indexed columns in WHERE</h3><p>If you apply a function to an indexed column in the WHERE clause, that index will not be used.</p><p><strong>Example:</strong></p><p>Less optimal:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>YEAR</span>(registration_date) <span style=color:#f92672>=</span> <span style=color:#ae81ff>2023</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (will not use index on registration_date)
</span></span></span></code></pre></div><p>More optimal:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> registration_date <span style=color:#66d9ef>BETWEEN</span> <span style=color:#e6db74>&#39;2023-01-01&#39;</span> <span style=color:#66d9ef>AND</span> <span style=color:#e6db74>&#39;2023-12-31&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (can use index)
</span></span></span></code></pre></div><h2 id=advanced-optimization-techniques>Advanced Optimization Techniques</h2><h3 id=use-limit-and-offset-efficiently>Use LIMIT and OFFSET efficiently</h3><p>When paginating, large OFFSET can be very slow because MySQL still has to read and discard many rows before returning results.</p><p><strong>Pagination optimization technique</strong>: Use index and subquery to get PRIMARY KEY of needed rows first, then JOIN with main table.</p><h3 id=optimize-like-clauses>Optimize LIKE clauses</h3><ul><li>If <code>LIKE '%value'</code>, index will not be used</li><li>If <code>LIKE 'value%'</code>, index can be used</li><li>Consider using Full-Text Search or specialized search solutions for complex string searches</li></ul><h3 id=use-union-all-instead-of-union>Use UNION ALL instead of UNION</h3><p>UNION ALL doesn&rsquo;t remove duplicate records, so it&rsquo;s faster than UNION (unless you really need to remove duplicates).</p><h3 id=avoid-order-by-rand>Avoid ORDER BY RAND()</h3><p>Very slow on large datasets. Use other methods to get random samples (e.g., get a random ID in a range then query that ID).</p><h2 id=optimization-for-read-and-write-operations>Optimization for Read and Write Operations</h2><h3 id=read-select>Read (SELECT)</h3><p>Focus on indexes, optimizing JOIN and WHERE clauses.</p><h3 id=write-insertupdatedelete>Write (INSERT/UPDATE/DELETE)</h3><p>Less likely to optimize by rewriting queries, but optimizing WHERE clauses is still important to find rows to update/delete quickly. For bulk INSERT, consider using <code>LOAD DATA INFILE</code> or <code>INSERT INTO ... VALUES (),(),()...</code>.</p><h2 id=tools>Tools</h2><p><strong>EXPLAIN</strong> is the primary tool to see whether query rewriting produces a better execution plan.</p><hr><p><em>Next: Learn how to analyze <a href=../execution-plans/>Execution Plans</a> to understand query performance.</em></p></div></div></section><script>document.getElementById("sidebar-toggle").addEventListener("click",function(e){e.preventDefault(),document.getElementById("sidebar").classList.toggle("open")})</script></body></html>