<!doctype html><html lang=vi><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Kế hoạch Thực thi - RDS Performance Insights & Tối Ưu Hóa Truy Vấn</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css><link rel=stylesheet href=/css/theme-blue.css><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:work sans,helvetica,tahoma,geneva,arial,sans-serif;font-weight:300;line-height:1.6;font-size:18px;color:var(--MAIN-TEXT-color,#323232)}#sidebar{position:fixed;top:0;left:0;width:300px;height:100vh;background:var(--MENU-SECTIONS-BG-color,#252c31);color:#ccc;overflow-y:auto;z-index:1000}#sidebar #header{padding:2rem 1rem;text-align:center;background:var(--MENU-HEADER-BG-color,#1C90F3);border-bottom:1px solid var(--MENU-HEADER-BORDER-color,#33a1ff)}#sidebar #header .baseurl{color:var(--MENU-SEARCH-BOX-color,#33a1ff);font-size:1.5rem;font-weight:700}#sidebar .searchbox{padding:10px;background:var(--MENU-SEARCH-BG-color,#167ad0);border-bottom:1px solid var(--MENU-SEARCH-BOX-color,#33a1ff)}#sidebar .searchbox input{width:100%;padding:10px;border:1px solid var(--MENU-SEARCH-BOX-color,#33a1ff);background:rgba(255,255,255,.1);color:var(--MENU-SEARCH-BOX-ICONS-color,#a1d2fd);border-radius:4px}#sidebar-toggle-span{display:none}#body{margin-left:300px}#body .padding{padding:3rem 6rem}#sidebar ul{list-style:none;padding:0;margin:0}#sidebar ul li a{display:block;padding:10px 20px;color:var(--MENU-SECTIONS-LINK-color,#ccc);text-decoration:none;border-left:4px solid transparent}#sidebar ul li a:hover{background:var(--MENU-SECTIONS-ACTIVE-BG-color,#20272b);border-left-color:var(--MAIN-LINK-color,#1C90F3);color:var(--MENU-SECTIONS-LINK-HOVER-color,#e6e6e6)}#sidebar ul li.active>a{background:var(--MENU-SECTION-ACTIVE-CATEGORY-BG-color,#fff);border-left-color:var(--MAIN-LINK-color,#1C90F3);color:var(--MENU-SECTION-ACTIVE-CATEGORY-color,#777)}#sidebar ul ul{padding-left:20px}#sidebar ul ul li a{padding:8px 20px;font-size:.9em}.language-switcher{position:relative;padding:20px}.language-switcher a{color:var(--MAIN-LINK-color,#1C90F3);text-decoration:none;margin-left:10px}.language-switcher a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0)}h1,h2,h3,h4,h5,h6{color:var(--MAIN-TITLES-TEXT-color,#5e5e5e);font-weight:400}h1{font-size:3rem}h2{font-size:2.5rem}h3{font-size:2rem}a{color:var(--MAIN-LINK-color,#1C90F3)}a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0)}pre{background:#f8f8f8;padding:1rem;border-radius:4px;overflow-x:auto}code{background:#f8f8f8;padding:.2rem .4rem;border-radius:3px;font-size:.9em}.breadcrumbs{margin-bottom:2rem;color:#999}.breadcrumbs a{color:var(--MAIN-LINK-color,#1C90F3);text-decoration:none}.breadcrumbs a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0);text-decoration:underline}@media(max-width:768px){#sidebar{transform:translateX(-300px);transition:transform .3s}#sidebar.open{transform:translateX(0)}#body{margin-left:0}#body .padding{padding:1rem 2rem}#sidebar-toggle-span{display:block;position:fixed;top:10px;left:10px;z-index:1001}#sidebar-toggle{background:var(--MAIN-LINK-color,#1C90F3);color:#fff;padding:10px;border:none;border-radius:4px}}</style></head><body><nav id=sidebar><div id=header><a id=logo href=/><div style=text-align:center;padding:20px><h2 style=color:var(--MENU-SEARCH-BOX-color,#33a1ff);font-size:2rem;font-weight:700;margin:0>LEARN</h2><p style="color:var(--MENU-SEARCH-BOX-ICONS-color,#a1d2fd);font-size:.9rem;margin:5px 0 0">RDS Performance Insights</p></div></a></div><div class=searchbox><input type=search placeholder=Search... id=search-input></div><ul class=topics><li><a href=http://localhost:1313/><i class="fas fa-home"></i> Home</a></li><li><a href=/vi/introduction/><i class="fas fa-book"></i> 1. Giới Thiệu</a></li><li><a href=/vi/preparation/><i class="fas fa-book"></i> 2. Chuẩn Bị</a></li><li><a href=/vi/performance-baseline/><i class="fas fa-book"></i> 3. Thiết lập Đường cơ sở Hiệu suất</a></li><li><a href=/vi/performance-insights/><i class="fas fa-book"></i> Performance Insights</a></li><li><a href=/vi/monitoring-dashboard/><i class="fas fa-book"></i> 4. Bảng điều khiển Giám sát</a></li><li><a href=/vi/alerting-system/><i class="fas fa-book"></i> 5. Hệ thống Cảnh báo</a></li><li class=active><a href=/vi/query-optimization/><i class="fas fa-book"></i> 6. Kỹ thuật Tối ưu hóa Truy vấn</a><ul><li><a href=/vi/query-optimization/overview/>Tổng quan</a></li><li><a href=/vi/query-optimization/index-strategies/>Chiến lược Index</a></li><li><a href=/vi/query-optimization/query-rewriting/>Viết lại Truy vấn</a></li><li class=active><a href=/vi/query-optimization/execution-plans/>Kế hoạch Thực thi</a></li></ul></li><li><a href=/vi/automated-tuning/><i class="fas fa-book"></i> 7. Đề xuất Điều chỉnh Tự động</a></li><li><a href=/vi/capacity-planning/><i class="fas fa-book"></i> 8. Lập kế hoạch Năng lực</a></li><li><a href=/vi/monitoring/><i class="fas fa-book"></i> 9. Giám sát & Cảnh báo</a></li><li><a href=/vi/best-practices/><i class="fas fa-book"></i> 10. Dọn dẹp Tài nguyên</a></li></ul><div class=language-switcher><a href=/vi/en><i class="fas fa-language"></i> English</a></div></nav><span id=sidebar-toggle-span><a href=# id=sidebar-toggle><i class="fas fa-bars"></i></a></span><section id=body><div id=overlay></div><div class=padding><div id=body-inner><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>
<span>> </span><a href=/vi/>RDS Performance Insights & Tối Ưu Hóa Truy Vấn</a>
<span>> </span><a href=/vi/query-optimization/>6. Kỹ thuật Tối ưu hóa Truy vấn</a>
<span>> </span>Kế hoạch Thực thi</div><h1>Kế hoạch Thực thi</h1><h1 id=kế-hoạch-thực-thi---hiểu-và-phân-tích-kế-hoạch-truy-vấn>Kế hoạch Thực thi - Hiểu và phân tích kế hoạch truy vấn</h1><p>Kế hoạch thực thi là &ldquo;lộ trình&rdquo; mà cơ sở dữ liệu sẽ đi theo để thực hiện một truy vấn. Hiểu được nó là chìa khóa để chẩn đoán và khắc phục các vấn đề hiệu suất truy vấn.</p><h2 id=cách-lấy-execution-plan>Cách lấy Execution Plan</h2><h3 id=sử-dụng-explain>Sử dụng EXPLAIN</h3><p>Sử dụng lệnh <code>EXPLAIN</code> trước bất kỳ truy vấn SQL nào:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>EXPLAIN</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span></code></pre></div><h3 id=sử-dụng-explain-analyze>Sử dụng EXPLAIN ANALYZE</h3><p>Có trong các phiên bản MySQL gần đây và PostgreSQL để thực sự chạy truy vấn và thu thập số liệu thống kê thời gian thực về kế hoạch thực thi, bao gồm thời gian và số hàng thực tế được xử lý:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>EXPLAIN</span> <span style=color:#66d9ef>ANALYZE</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> id <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span></code></pre></div><h2 id=các-yếu-tố-chính-cần-phân-tích-trong-một-execution-plan>Các yếu tố chính cần phân tích trong một Execution Plan</h2><h3 id=type>type</h3><p>Chỉ ra phương pháp truy cập bảng:</p><ul><li><code>ALL</code> - Xấu (quét toàn bộ bảng)</li><li><code>ref</code>, <code>eq_ref</code>, <code>const</code> - Tốt (sử dụng index hiệu quả)</li></ul><h3 id=key>key</h3><p>Index nào được sử dụng. Nếu <code>NULL</code>, không có index nào được sử dụng.</p><h3 id=rows>rows</h3><p>Số lượng hàng ước tính mà MySQL phải kiểm tra. Con số này càng nhỏ càng tốt. Một số lớn cho thấy quét bảng hoặc index không hiệu quả.</p><h3 id=filtered>filtered</h3><p>Phần trăm hàng ước tính còn lại sau khi áp dụng điều kiện bảng. Giá trị thấp cho thấy nhiều hàng đã được đọc nhưng bị loại bỏ sau đó.</p><h3 id=extra>Extra</h3><p>Cung cấp thông tin quan trọng về các hoạt động bổ sung mà trình tối ưu hóa phải thực hiện:</p><h4 id=using-filesort>Using filesort</h4><p>Sắp xếp dữ liệu bằng cách sử dụng một thuật toán tốn kém. Cố gắng sử dụng index để sắp xếp (thêm các cột ORDER BY vào index).</p><h4 id=using-temporary>Using temporary</h4><p>MySQL cần tạo bảng tạm thời trên đĩa hoặc trong bộ nhớ để xử lý truy vấn (ví dụ: cho GROUP BY hoặc DISTINCT không thể dùng index). Cố gắng tối ưu hóa truy vấn để tránh điều này.</p><h4 id=using-where>Using where</h4><p>Mệnh đề WHERE được áp dụng để lọc hàng. Nếu kết hợp với ALL, nó cho thấy quét bảng không hiệu quả.</p><h4 id=using-index>Using index</h4><p>Rất tốt! Truy vấn được thỏa mãn hoàn toàn bằng cách sử dụng index (covering index), không cần truy cập dữ liệu bảng.</p><h4 id=using-join-buffer>Using join buffer</h4><p>Dữ liệu đang được lưu vào bộ đệm cho các phép nối, điều này có thể chỉ ra một phép nối kém hiệu quả.</p><h2 id=các-vấn-đề-hiệu-suất-phổ-biến-và-giải-pháp>Các vấn đề hiệu suất phổ biến và giải pháp</h2><h3 id=quét-toàn-bộ-bảng-type--all>Quét toàn bộ bảng (type = ALL)</h3><p><strong>Vấn đề</strong>: Cơ sở dữ liệu đọc mọi hàng trong bảng
<strong>Giải pháp</strong>: Thêm index phù hợp trên các cột trong mệnh đề WHERE</p><h3 id=số-lượng-hàng-lớn>Số lượng hàng lớn</h3><p><strong>Vấn đề</strong>: Số lượng cao trong cột <code>rows</code>
<strong>Giải pháp</strong>:</p><ul><li>Thêm index có tính chọn lọc cao hơn</li><li>Viết lại truy vấn để cụ thể hơn</li><li>Cân nhắc tối ưu hóa truy vấn</li></ul><h3 id=using-filesort-1>Using filesort</h3><p><strong>Vấn đề</strong>: Thao tác sắp xếp tốn kém
<strong>Giải pháp</strong>: Tạo composite index bao gồm các cột ORDER BY</p><h3 id=using-temporary-1>Using temporary</h3><p><strong>Vấn đề</strong>: Chi phí tạo bảng tạm thời
<strong>Giải pháp</strong>:</p><ul><li>Tối ưu hóa mệnh đề GROUP BY</li><li>Thêm index phù hợp</li><li>Viết lại cấu trúc truy vấn</li></ul><h2 id=thực-hành-tốt-nhất-cho-phân-tích-execution-plan>Thực hành tốt nhất cho phân tích Execution Plan</h2><ol><li><strong>Luôn kiểm tra cột <code>type</code> trước</strong> - Tránh quét <code>ALL</code></li><li><strong>Tìm <code>NULL</code> trong cột <code>key</code></strong> - Cho thấy thiếu index</li><li><strong>Theo dõi cột <code>rows</code></strong> - Số lượng cao gợi ý cơ hội tối ưu hóa</li><li><strong>Chú ý thông tin <code>Extra</code></strong> - Cung cấp gợi ý tối ưu hóa quan trọng</li><li><strong>Sử dụng EXPLAIN ANALYZE khi có thể</strong> - Lấy thống kê thực tế vs ước tính</li></ol><h2 id=công-cụ-và-kỹ-thuật>Công cụ và kỹ thuật</h2><ul><li><strong>MySQL Workbench</strong>: Hiển thị execution plan trực quan</li><li><strong>Performance Schema</strong>: Phân tích truy vấn nâng cao</li><li><strong>Slow Query Log</strong>: Xác định các truy vấn có vấn đề</li><li><strong>Performance Insights</strong>: Công cụ phân tích chuyên dụng cho AWS RDS</li></ul><hr><p><em>Trước đó: <a href=../query-rewriting/>Viết lại Truy vấn</a> | Tiếp theo: Quay lại <a href=/vi/>Tổng quan Tối ưu hóa Truy vấn</a></em></p></div></div></section><script>document.getElementById("sidebar-toggle").addEventListener("click",function(e){e.preventDefault(),document.getElementById("sidebar").classList.toggle("open")})</script></body></html>