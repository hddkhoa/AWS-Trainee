<!doctype html><html lang=vi><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Viết lại Truy vấn - RDS Performance Insights & Tối Ưu Hóa Truy Vấn</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css><link rel=stylesheet href=/css/theme-blue.css><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:work sans,helvetica,tahoma,geneva,arial,sans-serif;font-weight:300;line-height:1.6;font-size:18px;color:var(--MAIN-TEXT-color,#323232)}#sidebar{position:fixed;top:0;left:0;width:300px;height:100vh;background:var(--MENU-SECTIONS-BG-color,#252c31);color:#ccc;overflow-y:auto;z-index:1000}#sidebar #header{padding:2rem 1rem;text-align:center;background:var(--MENU-HEADER-BG-color,#1C90F3);border-bottom:1px solid var(--MENU-HEADER-BORDER-color,#33a1ff)}#sidebar #header .baseurl{color:var(--MENU-SEARCH-BOX-color,#33a1ff);font-size:1.5rem;font-weight:700}#sidebar .searchbox{padding:10px;background:var(--MENU-SEARCH-BG-color,#167ad0);border-bottom:1px solid var(--MENU-SEARCH-BOX-color,#33a1ff)}#sidebar .searchbox input{width:100%;padding:10px;border:1px solid var(--MENU-SEARCH-BOX-color,#33a1ff);background:rgba(255,255,255,.1);color:var(--MENU-SEARCH-BOX-ICONS-color,#a1d2fd);border-radius:4px}#sidebar-toggle-span{display:none}#body{margin-left:300px}#body .padding{padding:3rem 6rem}#sidebar ul{list-style:none;padding:0;margin:0}#sidebar ul li a{display:block;padding:10px 20px;color:var(--MENU-SECTIONS-LINK-color,#ccc);text-decoration:none;border-left:4px solid transparent}#sidebar ul li a:hover{background:var(--MENU-SECTIONS-ACTIVE-BG-color,#20272b);border-left-color:var(--MAIN-LINK-color,#1C90F3);color:var(--MENU-SECTIONS-LINK-HOVER-color,#e6e6e6)}#sidebar ul li.active>a{background:var(--MENU-SECTION-ACTIVE-CATEGORY-BG-color,#fff);border-left-color:var(--MAIN-LINK-color,#1C90F3);color:var(--MENU-SECTION-ACTIVE-CATEGORY-color,#777)}#sidebar ul ul{padding-left:20px}#sidebar ul ul li a{padding:8px 20px;font-size:.9em}.language-switcher{position:relative;padding:20px}.language-switcher a{color:var(--MAIN-LINK-color,#1C90F3);text-decoration:none;margin-left:10px}.language-switcher a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0)}h1,h2,h3,h4,h5,h6{color:var(--MAIN-TITLES-TEXT-color,#5e5e5e);font-weight:400}h1{font-size:3rem}h2{font-size:2.5rem}h3{font-size:2rem}a{color:var(--MAIN-LINK-color,#1C90F3)}a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0)}pre{background:#f8f8f8;padding:1rem;border-radius:4px;overflow-x:auto}code{background:#f8f8f8;padding:.2rem .4rem;border-radius:3px;font-size:.9em}.breadcrumbs{margin-bottom:2rem;color:#999}.breadcrumbs a{color:var(--MAIN-LINK-color,#1C90F3);text-decoration:none}.breadcrumbs a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0);text-decoration:underline}@media(max-width:768px){#sidebar{transform:translateX(-300px);transition:transform .3s}#sidebar.open{transform:translateX(0)}#body{margin-left:0}#body .padding{padding:1rem 2rem}#sidebar-toggle-span{display:block;position:fixed;top:10px;left:10px;z-index:1001}#sidebar-toggle{background:var(--MAIN-LINK-color,#1C90F3);color:#fff;padding:10px;border:none;border-radius:4px}}</style></head><body><nav id=sidebar><div id=header><a id=logo href=/><div style=text-align:center;padding:20px><h2 style=color:var(--MENU-SEARCH-BOX-color,#33a1ff);font-size:2rem;font-weight:700;margin:0>LEARN</h2><p style="color:var(--MENU-SEARCH-BOX-ICONS-color,#a1d2fd);font-size:.9rem;margin:5px 0 0">RDS Performance Insights</p></div></a></div><div class=searchbox><input type=search placeholder=Search... id=search-input></div><ul class=topics><li><a href=http://localhost:1313/><i class="fas fa-home"></i> Home</a></li><li><a href=/vi/introduction/><i class="fas fa-book"></i> 1. Giới Thiệu</a></li><li><a href=/vi/preparation/><i class="fas fa-book"></i> 2. Chuẩn Bị</a></li><li><a href=/vi/performance-baseline/><i class="fas fa-book"></i> 3. Thiết lập Đường cơ sở Hiệu suất</a></li><li><a href=/vi/performance-insights/><i class="fas fa-book"></i> Performance Insights</a></li><li><a href=/vi/monitoring-dashboard/><i class="fas fa-book"></i> 4. Bảng điều khiển Giám sát</a></li><li><a href=/vi/alerting-system/><i class="fas fa-book"></i> 5. Hệ thống Cảnh báo</a></li><li class=active><a href=/vi/query-optimization/><i class="fas fa-book"></i> 6. Kỹ thuật Tối ưu hóa Truy vấn</a><ul><li><a href=/vi/query-optimization/overview/>Tổng quan</a></li><li><a href=/vi/query-optimization/index-strategies/>Chiến lược Index</a></li><li class=active><a href=/vi/query-optimization/query-rewriting/>Viết lại Truy vấn</a></li><li><a href=/vi/query-optimization/execution-plans/>Kế hoạch Thực thi</a></li></ul></li><li><a href=/vi/automated-tuning/><i class="fas fa-book"></i> 7. Đề xuất Điều chỉnh Tự động</a></li><li><a href=/vi/capacity-planning/><i class="fas fa-book"></i> 8. Lập kế hoạch Năng lực</a></li><li><a href=/vi/monitoring/><i class="fas fa-book"></i> 9. Giám sát & Cảnh báo</a></li><li><a href=/vi/best-practices/><i class="fas fa-book"></i> 10. Dọn dẹp tài nguyên</a></li></ul><div class=language-switcher><a href=/vi/en><i class="fas fa-language"></i> English</a></div></nav><span id=sidebar-toggle-span><a href=# id=sidebar-toggle><i class="fas fa-bars"></i></a></span><section id=body><div id=overlay></div><div class=padding><div id=body-inner><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>
<span>> </span><a href=/vi/>RDS Performance Insights & Tối Ưu Hóa Truy Vấn</a>
<span>> </span><a href=/vi/query-optimization/>6. Kỹ thuật Tối ưu hóa Truy vấn</a>
<span>> </span>Viết lại Truy vấn</div><h1>Viết lại Truy vấn</h1><h1 id=viết-lại-truy-vấn---nắm-vững-các-mẫu-tối-ưu-hóa-truy-vấn>Viết lại Truy vấn - Nắm vững các mẫu tối ưu hóa truy vấn</h1><p>Viết lại hoặc điều chỉnh cấu trúc của truy vấn SQL có thể ảnh hưởng lớn đến cách cơ sở dữ liệu thực thi chúng. Mục tiêu là giúp trình tối ưu hóa truy vấn (Query Optimizer) của cơ sở dữ liệu chọn một kế hoạch thực thi hiệu quả hơn.</p><h2 id=các-nguyên-tắc-cơ-bản>Các nguyên tắc cơ bản</h2><h3 id=tránh-select->Tránh SELECT *</h3><p>Chỉ chọn những cột bạn thực sự cần. Điều này giảm lượng dữ liệu đọc từ đĩa và truyền qua mạng.</p><h3 id=sử-dụng-join-thay-vì-subqueries-đối-với-một-số-trường-hợp>Sử dụng JOIN thay vì Subqueries (đối với một số trường hợp)</h3><p>Đôi khi, subquery (truy vấn con) có thể được viết lại thành JOIN để cải thiện hiệu suất, đặc biệt là IN subquery.</p><p><strong>Ví dụ:</strong></p><p>Kém tối ưu:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> orders 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> customer_id <span style=color:#66d9ef>IN</span> (<span style=color:#66d9ef>SELECT</span> id <span style=color:#66d9ef>FROM</span> customers <span style=color:#66d9ef>WHERE</span> region <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Asia&#39;</span>);
</span></span></code></pre></div><p>Tối ưu hơn:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> o.<span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> orders o 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> customers <span style=color:#66d9ef>c</span> <span style=color:#66d9ef>ON</span> o.customer_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>c</span>.region <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Asia&#39;</span>;
</span></span></code></pre></div><h3 id=tránh-các-phép-toán-hoặc-hàm-trên-cột-được-lập-chỉ-mục-trong-where>Tránh các phép toán hoặc hàm trên cột được lập chỉ mục trong WHERE</h3><p>Nếu bạn áp dụng một hàm cho cột được lập chỉ mục trong mệnh đề WHERE, index đó sẽ không được sử dụng.</p><p><strong>Ví dụ:</strong></p><p>Kém tối ưu:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>YEAR</span>(registration_date) <span style=color:#f92672>=</span> <span style=color:#ae81ff>2023</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (sẽ không dùng index trên registration_date)
</span></span></span></code></pre></div><p>Tối ưu hơn:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> users 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> registration_date <span style=color:#66d9ef>BETWEEN</span> <span style=color:#e6db74>&#39;2023-01-01&#39;</span> <span style=color:#66d9ef>AND</span> <span style=color:#e6db74>&#39;2023-12-31&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>-- (có thể dùng index)
</span></span></span></code></pre></div><h2 id=các-kỹ-thuật-tối-ưu-hóa-nâng-cao>Các kỹ thuật tối ưu hóa nâng cao</h2><h3 id=sử-dụng-limit-và-offset-hiệu-quả>Sử dụng LIMIT và OFFSET hiệu quả</h3><p>Khi phân trang, OFFSET lớn có thể rất chậm vì MySQL vẫn phải đọc và loại bỏ nhiều hàng trước khi trả về kết quả.</p><p><strong>Kỹ thuật tối ưu hóa phân trang</strong>: Sử dụng index và truy vấn con để lấy PRIMARY KEY của các hàng cần thiết trước, sau đó JOIN với bảng chính.</p><h3 id=tối-ưu-hóa-mệnh-đề-like>Tối ưu hóa mệnh đề LIKE</h3><ul><li>Nếu <code>LIKE '%value'</code>, index sẽ không được sử dụng</li><li>Nếu <code>LIKE 'value%'</code>, index có thể được sử dụng</li><li>Cân nhắc sử dụng Full-Text Search hoặc các giải pháp tìm kiếm chuyên dụng cho các tìm kiếm chuỗi phức tạp</li></ul><h3 id=sử-dụng-union-all-thay-vì-union>Sử dụng UNION ALL thay vì UNION</h3><p>UNION ALL không loại bỏ các bản ghi trùng lặp, nên nhanh hơn UNION (trừ khi bạn thực sự cần loại bỏ trùng lặp).</p><h3 id=tránh-order-by-rand>Tránh ORDER BY RAND()</h3><p>Rất chậm trên tập dữ liệu lớn. Hãy sử dụng các phương pháp khác để lấy mẫu ngẫu nhiên (ví dụ: lấy một ID ngẫu nhiên trong một phạm vi rồi truy vấn ID đó).</p><h2 id=tối-ưu-hóa-cho-các-thao-tác-đọc-và-ghi>Tối ưu hóa cho các thao tác đọc và ghi</h2><h3 id=đọc-select>Đọc (SELECT)</h3><p>Tập trung vào index, tối ưu hóa JOIN và WHERE clause.</p><h3 id=ghi-insertupdatedelete>Ghi (INSERT/UPDATE/DELETE)</h3><p>Ít có khả năng tối ưu hóa bằng cách viết lại truy vấn nhiều, nhưng việc tối ưu hóa WHERE clause vẫn quan trọng để tìm các hàng cần cập nhật/xóa nhanh chóng. Đối với INSERT hàng loạt, hãy cân nhắc sử dụng <code>LOAD DATA INFILE</code> hoặc <code>INSERT INTO ... VALUES (),(),()...</code>.</p><h2 id=công-cụ>Công cụ</h2><p><strong>EXPLAIN</strong> là công cụ chính để xem liệu việc viết lại truy vấn có tạo ra một kế hoạch thực thi tốt hơn hay không.</p><hr><p><em>Tiếp theo: Tìm hiểu cách phân tích <a href=../execution-plans/>Kế hoạch Thực thi</a> để hiểu hiệu suất truy vấn.</em></p></div></div></section><script>document.getElementById("sidebar-toggle").addEventListener("click",function(e){e.preventDefault(),document.getElementById("sidebar").classList.toggle("open")})</script></body></html>