<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Query Optimization with Performance Insights - RDS Performance Insights & Query Optimization</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css><link rel=stylesheet href=/css/theme-blue.css><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:work sans,helvetica,tahoma,geneva,arial,sans-serif;font-weight:300;line-height:1.6;font-size:18px;color:var(--MAIN-TEXT-color,#323232)}#sidebar{position:fixed;top:0;left:0;width:300px;height:100vh;background:var(--MENU-SECTIONS-BG-color,#252c31);color:#ccc;overflow-y:auto;z-index:1000}#sidebar #header{padding:2rem 1rem;text-align:center;background:var(--MENU-HEADER-BG-color,#1C90F3);border-bottom:1px solid var(--MENU-HEADER-BORDER-color,#33a1ff)}#sidebar #header .baseurl{color:var(--MENU-SEARCH-BOX-color,#33a1ff);font-size:1.5rem;font-weight:700}#sidebar .searchbox{padding:10px;background:var(--MENU-SEARCH-BG-color,#167ad0);border-bottom:1px solid var(--MENU-SEARCH-BOX-color,#33a1ff)}#sidebar .searchbox input{width:100%;padding:10px;border:1px solid var(--MENU-SEARCH-BOX-color,#33a1ff);background:rgba(255,255,255,.1);color:var(--MENU-SEARCH-BOX-ICONS-color,#a1d2fd);border-radius:4px}#sidebar-toggle-span{display:none}#body{margin-left:300px}#body .padding{padding:3rem 6rem}#sidebar ul{list-style:none;padding:0;margin:0}#sidebar ul li a{display:block;padding:10px 20px;color:var(--MENU-SECTIONS-LINK-color,#ccc);text-decoration:none;border-left:4px solid transparent}#sidebar ul li a:hover{background:var(--MENU-SECTIONS-ACTIVE-BG-color,#20272b);border-left-color:var(--MAIN-LINK-color,#1C90F3);color:var(--MENU-SECTIONS-LINK-HOVER-color,#e6e6e6)}#sidebar ul li.active>a{background:var(--MENU-SECTION-ACTIVE-CATEGORY-BG-color,#fff);border-left-color:var(--MAIN-LINK-color,#1C90F3);color:var(--MENU-SECTION-ACTIVE-CATEGORY-color,#777)}#sidebar ul ul{padding-left:20px}#sidebar ul ul li a{padding:8px 20px;font-size:.9em}.language-switcher{position:relative;padding:20px}.language-switcher a{color:var(--MAIN-LINK-color,#1C90F3);text-decoration:none;margin-left:10px}.language-switcher a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0)}h1,h2,h3,h4,h5,h6{color:var(--MAIN-TITLES-TEXT-color,#5e5e5e);font-weight:400}h1{font-size:3rem}h2{font-size:2.5rem}h3{font-size:2rem}a{color:var(--MAIN-LINK-color,#1C90F3)}a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0)}pre{background:#f8f8f8;padding:1rem;border-radius:4px;overflow-x:auto}code{background:#f8f8f8;padding:.2rem .4rem;border-radius:3px;font-size:.9em}.breadcrumbs{margin-bottom:2rem;color:#999}.breadcrumbs a{color:var(--MAIN-LINK-color,#1C90F3);text-decoration:none}.breadcrumbs a:hover{color:var(--MAIN-LINK-HOVER-color,#167ad0);text-decoration:underline}@media(max-width:768px){#sidebar{transform:translateX(-300px);transition:transform .3s}#sidebar.open{transform:translateX(0)}#body{margin-left:0}#body .padding{padding:1rem 2rem}#sidebar-toggle-span{display:block;position:fixed;top:10px;left:10px;z-index:1001}#sidebar-toggle{background:var(--MAIN-LINK-color,#1C90F3);color:#fff;padding:10px;border:none;border-radius:4px}}</style></head><body><nav id=sidebar><div id=header><a id=logo href=/><div style=text-align:center;padding:20px><h2 style=color:var(--MENU-SEARCH-BOX-color,#33a1ff);font-size:2rem;font-weight:700;margin:0>LEARN</h2><p style="color:var(--MENU-SEARCH-BOX-ICONS-color,#a1d2fd);font-size:.9rem;margin:5px 0 0">RDS Performance Insights</p></div></a></div><div class=searchbox><input type=search placeholder=Search... id=search-input></div><ul class=topics><li><a href=http://localhost:1313/><i class="fas fa-home"></i> Home</a></li><li><a href=/introduction/><i class="fas fa-book"></i> 1. Introduction</a></li><li><a href=/preparation/><i class="fas fa-book"></i> 2. Preparation</a></li><li><a href=/performance-baseline/><i class="fas fa-book"></i> 3. Performance Baseline Establishment</a></li><li class=active><a href=/performance-insights/><i class="fas fa-book"></i> Performance Insights</a><ul><li><a href=/performance-insights/overview/>Performance Insights Overview</a></li><li><a href=/performance-insights/setup/>Setting up RDS Instance with Performance Insights</a></li><li><a href=/performance-insights/dashboard/>Understanding the Performance Insights Dashboard</a></li><li class=active><a href=/performance-insights/optimization/>Query Optimization with Performance Insights</a></li></ul></li><li><a href=/monitoring-dashboard/><i class="fas fa-book"></i> 4. Monitoring Dashboard</a></li><li><a href=/alerting-system/><i class="fas fa-book"></i> 5. Alerting System</a></li><li><a href=/query-optimization/><i class="fas fa-book"></i> 6. Query Optimization Techniques</a></li><li><a href=/automated-tuning/><i class="fas fa-book"></i> 7. Automated Tuning Recommendations</a></li><li><a href=/capacity-planning/><i class="fas fa-book"></i> 8. Capacity Planning</a></li><li><a href=/monitoring/><i class="fas fa-book"></i> 9. Monitoring & Alerting</a></li><li><a href=/best-practices/><i class="fas fa-book"></i> 10. Cleanup Resources</a></li></ul><div class=language-switcher><a href=/vi><i class="fas fa-language"></i> Tiếng Việt</a></div></nav><span id=sidebar-toggle-span><a href=# id=sidebar-toggle><i class="fas fa-bars"></i></a></span><section id=body><div id=overlay></div><div class=padding><div id=body-inner><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>
<span>> </span><a href=/>RDS Performance Insights & Query Optimization</a>
<span>> </span><a href=/performance-insights/>Performance Insights</a>
<span>> </span>Query Optimization with Performance Insights</div><h1>Query Optimization with Performance Insights</h1><h2 id=query-optimization-process>Query Optimization Process</h2><p>Using Performance Insights for query optimization follows a systematic approach:</p><ol><li><strong>Identify problematic queries</strong> using Top SQL</li><li><strong>Analyze query execution patterns</strong> and wait events</li><li><strong>Investigate query execution plans</strong></li><li><strong>Apply optimization techniques</strong></li><li><strong>Monitor optimization results</strong></li></ol><h2 id=identifying-problematic-queries>Identifying Problematic Queries</h2><h3 id=using-top-sql-panel>Using Top SQL Panel</h3><p>The Top SQL panel shows queries ranked by their contribution to database load:</p><pre tabindex=0><code>Top SQL (by Load)
┌─────────────────────────────────────────────────────────┐
│ SQL ID: 0x1A2B3C4D5E6F | Load: 3.2 AAS (40%)          │
│ SELECT * FROM orders WHERE order_date &gt; ?               │
│ Executions: 150/min | Avg Latency: 1.8s                │
├─────────────────────────────────────────────────────────┤
│ SQL ID: 0x2B3C4D5E6F7A | Load: 2.1 AAS (26%)          │
│ UPDATE inventory SET quantity = ? WHERE product_id = ?  │
│ Executions: 80/min | Avg Latency: 2.3s                 │
└─────────────────────────────────────────────────────────┘
</code></pre><h3 id=key-metrics-to-focus-on>Key Metrics to Focus On</h3><ol><li><strong>High Load Contribution:</strong> Queries contributing >10% of total load</li><li><strong>High Execution Frequency:</strong> Queries running >100 times/minute</li><li><strong>High Average Latency:</strong> Queries taking >1 second on average</li><li><strong>Trending Upward:</strong> Queries with increasing load over time</li></ol><h2 id=query-analysis-techniques>Query Analysis Techniques</h2><h3 id=1-execution-statistics-analysis>1. Execution Statistics Analysis</h3><p>For each problematic query, analyze:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Example problematic query
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> o.<span style=color:#f92672>*</span>, <span style=color:#66d9ef>c</span>.name, <span style=color:#66d9ef>c</span>.email 
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> orders o 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> customers <span style=color:#66d9ef>c</span> <span style=color:#66d9ef>ON</span> o.customer_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> o.order_date <span style=color:#f92672>&gt;=</span> <span style=color:#e6db74>&#39;2024-01-01&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> o.order_date <span style=color:#66d9ef>DESC</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Performance Insights Metrics:
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> <span style=color:#66d9ef>Load</span>: <span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>5</span> AAS (<span style=color:#ae81ff>31</span><span style=color:#f92672>%</span> <span style=color:#66d9ef>of</span> total)
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> Executions: <span style=color:#ae81ff>200</span><span style=color:#f92672>/</span><span style=color:#66d9ef>min</span>
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> <span style=color:#66d9ef>Avg</span> Latency: <span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>2</span>s
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> <span style=color:#66d9ef>Rows</span> Examined: <span style=color:#ae81ff>500</span>K
</span></span><span style=display:flex><span><span style=color:#f92672>-</span> <span style=color:#66d9ef>Rows</span> Returned: <span style=color:#ae81ff>100</span>
</span></span></code></pre></div><p><strong>Analysis:</strong></p><ul><li>High rows examined vs returned ratio (5000:1)</li><li>Suggests missing or inefficient indexes</li><li>ORDER BY without index causing filesort</li></ul><h3 id=2-wait-event-analysis>2. Wait Event Analysis</h3><p>Check what the query is waiting for:</p><pre tabindex=0><code>Wait Events for SQL ID 0x1A2B3C4D5E6F:
├── io/table/sql/handler: 60% (I/O operations)
├── filesort: 25% (Sorting without index)
├── CPU: 10% (Processing)
└── synch/mutex/innodb: 5% (Lock contention)
</code></pre><p><strong>Interpretation:</strong></p><ul><li>High I/O waits suggest missing indexes</li><li>Filesort waits indicate ORDER BY optimization needed</li><li>Low CPU suggests not computation-bound</li></ul><h2 id=common-optimization-techniques>Common Optimization Techniques</h2><h3 id=1-index-optimization>1. Index Optimization</h3><h4 id=missing-index-detection>Missing Index Detection</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Before optimization
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> orders 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> order_date <span style=color:#f92672>&gt;=</span> <span style=color:#e6db74>&#39;2024-01-01&#39;</span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>AND</span> status <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;pending&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Performance Insights shows:
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - High io/table/sql/handler waits
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Rows examined: 1M, Rows returned: 1K
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Add composite index
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_orders_date_status 
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> orders(order_date, status);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- After optimization:
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Rows examined: 1K, Rows returned: 1K
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Latency reduced from 2.1s to 0.05s
</span></span></span></code></pre></div><h4 id=covering-index-implementation>Covering Index Implementation</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Frequently accessed columns
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> order_id, customer_id, order_date, total_amount 
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> orders 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> status <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;completed&#39;</span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>AND</span> order_date <span style=color:#f92672>&gt;=</span> <span style=color:#e6db74>&#39;2024-01-01&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Create covering index
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_orders_covering 
</span></span><span style=display:flex><span><span style=color:#66d9ef>ON</span> orders(status, order_date, order_id, customer_id, total_amount);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Benefits:
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Eliminates table lookups
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Reduces I/O operations
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Improves query performance by 70%
</span></span></span></code></pre></div><h3 id=2-query-rewriting>2. Query Rewriting</h3><h4 id=avoiding-select->Avoiding SELECT *</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Problematic query
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> products p 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> categories <span style=color:#66d9ef>c</span> <span style=color:#66d9ef>ON</span> p.category_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> p.price <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Optimized query
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> p.id, p.name, p.price, <span style=color:#66d9ef>c</span>.name <span style=color:#66d9ef>as</span> category_name 
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> products p 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> categories <span style=color:#66d9ef>c</span> <span style=color:#66d9ef>ON</span> p.category_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> p.price <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Performance improvement:
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Reduced data transfer
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Lower memory usage
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Faster network transmission
</span></span></span></code></pre></div><h4 id=optimizing-joins>Optimizing JOINs</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Inefficient JOIN order
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> o.order_id, <span style=color:#66d9ef>c</span>.name, p.product_name 
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> orders o 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> order_items oi <span style=color:#66d9ef>ON</span> o.order_id <span style=color:#f92672>=</span> oi.order_id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> products p <span style=color:#66d9ef>ON</span> oi.product_id <span style=color:#f92672>=</span> p.product_id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> customers <span style=color:#66d9ef>c</span> <span style=color:#66d9ef>ON</span> o.customer_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.customer_id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> o.order_date <span style=color:#f92672>&gt;=</span> <span style=color:#e6db74>&#39;2024-01-01&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Optimized with proper JOIN order and conditions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> o.order_id, <span style=color:#66d9ef>c</span>.name, p.product_name 
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> orders o 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> customers <span style=color:#66d9ef>c</span> <span style=color:#66d9ef>ON</span> o.customer_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>c</span>.customer_id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> order_items oi <span style=color:#66d9ef>ON</span> o.order_id <span style=color:#f92672>=</span> oi.order_id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>JOIN</span> products p <span style=color:#66d9ef>ON</span> oi.product_id <span style=color:#f92672>=</span> p.product_id 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> o.order_date <span style=color:#f92672>&gt;=</span> <span style=color:#e6db74>&#39;2024-01-01&#39;</span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>AND</span> o.status <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;completed&#39;</span>;
</span></span></code></pre></div><h3 id=3-pagination-optimization>3. Pagination Optimization</h3><h4 id=inefficient-offset-pagination>Inefficient OFFSET Pagination</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Problematic for large offsets
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> orders 
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> order_date <span style=color:#66d9ef>DESC</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>20</span> <span style=color:#66d9ef>OFFSET</span> <span style=color:#ae81ff>10000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Performance Insights shows:
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - High filesort waits
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Increasing latency with larger offsets
</span></span></span></code></pre></div><h4 id=cursor-based-pagination>Cursor-based Pagination</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Efficient cursor-based approach
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> orders 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> order_date <span style=color:#f92672>&lt;</span> <span style=color:#e6db74>&#39;2024-01-15 10:30:00&#39;</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> order_date <span style=color:#66d9ef>DESC</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>20</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Benefits:
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Consistent performance regardless of page
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Uses index efficiently
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- - Eliminates filesort operations
</span></span></span></code></pre></div><h2 id=database-specific-optimizations>Database-Specific Optimizations</h2><h3 id=mysql-optimizations>MySQL Optimizations</h3><h4 id=innodb-configuration>InnoDB Configuration</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Check current settings
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> VARIABLES <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;innodb_buffer_pool_size&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SHOW</span> VARIABLES <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;innodb_log_file_size&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Optimize for your workload
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>GLOBAL</span> innodb_buffer_pool_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>1073741824</span>; <span style=color:#75715e>-- 1GB
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>GLOBAL</span> innodb_log_buffer_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>16777216</span>;    <span style=color:#75715e>-- 16MB
</span></span></span></code></pre></div><h4 id=query-cache-mysql-57-and-earlier>Query Cache (MySQL 5.7 and earlier)</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Enable query cache for read-heavy workloads
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>GLOBAL</span> query_cache_type <span style=color:#f92672>=</span> <span style=color:#66d9ef>ON</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>GLOBAL</span> query_cache_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>268435456</span>; <span style=color:#75715e>-- 256MB
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Monitor cache effectiveness
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> STATUS <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;Qcache%&#39;</span>;
</span></span></code></pre></div><h3 id=postgresql-optimizations>PostgreSQL Optimizations</h3><h4 id=configuration-tuning>Configuration Tuning</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Optimize shared_buffers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>SYSTEM</span> <span style=color:#66d9ef>SET</span> shared_buffers <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;256MB&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Optimize work_mem for sorting/hashing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>SYSTEM</span> <span style=color:#66d9ef>SET</span> work_mem <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;4MB&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Optimize effective_cache_size
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>SYSTEM</span> <span style=color:#66d9ef>SET</span> effective_cache_size <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;1GB&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Reload configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> pg_reload_conf();
</span></span></code></pre></div><h4 id=statistics-and-vacuum>Statistics and Vacuum</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Update table statistics
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ANALYZE</span> orders;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Vacuum to reclaim space
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>VACUUM</span> <span style=color:#66d9ef>ANALYZE</span> orders;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Auto-vacuum configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>SYSTEM</span> <span style=color:#66d9ef>SET</span> autovacuum <span style=color:#f92672>=</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>SYSTEM</span> <span style=color:#66d9ef>SET</span> autovacuum_vacuum_scale_factor <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>1</span>;
</span></span></code></pre></div><h2 id=monitoring-optimization-results>Monitoring Optimization Results</h2><h3 id=before-and-after-comparison>Before and After Comparison</h3><p>Track these metrics in Performance Insights:</p><pre tabindex=0><code>Query Optimization Results:
┌─────────────────────────────────────────────────────────┐
│                    BEFORE    │    AFTER    │ IMPROVEMENT │
├─────────────────────────────────────────────────────────┤
│ Load (AAS)         │  2.5    │    0.3     │    -88%     │
│ Avg Latency        │  1.8s   │    0.2s    │    -89%     │
│ Executions/min     │  150    │    150     │     0%      │
│ Rows Examined      │  500K   │    1K      │    -99.8%   │
│ CPU Wait %         │  15%    │    60%     │   Changed   │
│ I/O Wait %         │  70%    │    25%     │   Reduced   │
└─────────────────────────────────────────────────────────┘
</code></pre><h3 id=long-term-monitoring>Long-term Monitoring</h3><p>Set up monitoring for:</p><ol><li><p><strong>Query Performance Trends</strong></p><ul><li>Track latency over time</li><li>Monitor execution frequency changes</li><li>Watch for performance regressions</li></ul></li><li><p><strong>Resource Utilization</strong></p><ul><li>CPU usage patterns</li><li>I/O operation trends</li><li>Memory utilization</li></ul></li><li><p><strong>Wait Event Changes</strong></p><ul><li>Shift from I/O to CPU waits (good)</li><li>Emergence of new wait events</li><li>Lock contention patterns</li></ul></li></ol><h2 id=optimization-workflow>Optimization Workflow</h2><h3 id=1-identification-phase>1. Identification Phase</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Use Performance Insights to identify top queries</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Focus on queries with:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - Load &gt; 10% of total</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - Latency &gt; 1 second</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - High execution frequency</span>
</span></span></code></pre></div><h3 id=2-analysis-phase>2. Analysis Phase</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Get query execution plan
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>EXPLAIN</span> (<span style=color:#66d9ef>ANALYZE</span>, BUFFERS) 
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> orders <span style=color:#66d9ef>WHERE</span> order_date <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;2024-01-01&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Check index usage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>INDEX</span> <span style=color:#66d9ef>FROM</span> orders;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Analyze table statistics
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> <span style=color:#66d9ef>TABLE</span> STATUS <span style=color:#66d9ef>LIKE</span> <span style=color:#e6db74>&#39;orders&#39;</span>;
</span></span></code></pre></div><h3 id=3-optimization-phase>3. Optimization Phase</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- Apply optimizations
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>INDEX</span> idx_orders_date <span style=color:#66d9ef>ON</span> orders(order_date);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Rewrite query if needed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>SELECT</span> order_id, customer_id, total_amount 
</span></span><span style=display:flex><span><span style=color:#66d9ef>FROM</span> orders 
</span></span><span style=display:flex><span><span style=color:#66d9ef>WHERE</span> order_date <span style=color:#f92672>&gt;</span> <span style=color:#e6db74>&#39;2024-01-01&#39;</span>;
</span></span></code></pre></div><h3 id=4-validation-phase>4. Validation Phase</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Monitor in Performance Insights for:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - Reduced query load</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - Improved latency</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - Changed wait event patterns</span>
</span></span><span style=display:flex><span><span style=color:#75715e># - Overall database performance</span>
</span></span></code></pre></div><h2 id=best-practices>Best Practices</h2><h3 id=1-systematic-approach>1. Systematic Approach</h3><ul><li>Always measure before optimizing</li><li>Focus on highest-impact queries first</li><li>Test optimizations in staging environment</li><li>Monitor results over time</li></ul><h3 id=2-index-strategy>2. Index Strategy</h3><ul><li>Create indexes based on query patterns</li><li>Avoid over-indexing (impacts writes)</li><li>Use composite indexes effectively</li><li>Regular index maintenance</li></ul><h3 id=3-query-design>3. Query Design</h3><ul><li>Select only needed columns</li><li>Use appropriate WHERE clauses</li><li>Optimize JOIN conditions</li><li>Consider query caching</li></ul><h3 id=4-continuous-monitoring>4. Continuous Monitoring</h3><ul><li>Regular Performance Insights reviews</li><li>Set up alerts for performance degradation</li><li>Track optimization results</li><li>Plan for capacity growth</li></ul><h2 id=common-pitfalls>Common Pitfalls</h2><h3 id=1-over-optimization>1. Over-Optimization</h3><ul><li>Adding too many indexes</li><li>Premature optimization</li><li>Ignoring write performance impact</li></ul><h3 id=2-incomplete-analysis>2. Incomplete Analysis</h3><ul><li>Focusing only on individual queries</li><li>Ignoring overall system impact</li><li>Not considering concurrent workloads</li></ul><h3 id=3-lack-of-monitoring>3. Lack of Monitoring</h3><ul><li>Not tracking optimization results</li><li>Missing performance regressions</li><li>Inadequate alerting setup</li></ul><h2 id=next-steps>Next Steps</h2><ol><li><strong><a href=../alerting/>Performance Alerting</a></strong> - Set up performance alerts</li><li><strong><a href=/capacity-planning/>Capacity Planning</a></strong> - Plan for future growth</li><li><strong><a href=/best-practices/>Best Practices</a></strong> - Follow optimization best practices</li></ol></div></div></section><script>document.getElementById("sidebar-toggle").addEventListener("click",function(e){e.preventDefault(),document.getElementById("sidebar").classList.toggle("open")})</script></body></html>